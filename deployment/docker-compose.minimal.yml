# Minimal MCP Infrastructure - Bare Bones Setup
# Just the essentials for remote MCP access from any device

version: '3.8'

services:
  # ============================================================================
  # Cloudflare Tunnel - Secure remote access
  # ============================================================================
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    command: tunnel --no-autoupdate run
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # GitHub MCP Server - Repository, issue, and PR management
  # Custom built MCP server in /mcp/github
  # ============================================================================
  mcp-github:
    build:
      context: ../mcp/github
      dockerfile: Dockerfile
    container_name: mcp-github
    ports:
      - "3001:3000"
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # Google Services MCP Server - Gmail, Drive, Calendar
  # Custom built MCP server in /mcp/google
  # ============================================================================
  mcp-google:
    build:
      context: ../mcp/google
      dockerfile: Dockerfile
    container_name: mcp-google
    ports:
      - "3004:3000"
    environment:
      - GOOGLE_TOKEN_FILE=/app/credentials/token.json
      - GOOGLE_CREDENTIALS_FILE=/app/credentials/credentials.json
      - MCP_TRANSPORT=http
      - PORT=3000
    volumes:
      # Mount your Google OAuth credentials
      # After authenticating locally, copy token.json and credentials.json here
      - ./credentials/google:/app/credentials:ro
    networks:
      - mcp_network
    restart: unless-stopped
    # Note: You must authenticate locally first to generate token.json
    # See mcp/google/README.md for instructions

  # ============================================================================
  # Todoist MCP Server - Task management
  # Custom built MCP server in /mcp/todoist
  # ============================================================================
  mcp-todoist:
    build:
      context: ../mcp/todoist
      dockerfile: Dockerfile
    container_name: mcp-todoist
    ports:
      - "3005:3000"
    environment:
      - TODOIST_API_TOKEN=${TODOIST_API_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # Home Assistant MCP Server - Smart home control
  # Custom built MCP server in /mcp/homeassistant
  # ============================================================================
  mcp-homeassistant:
    build:
      context: ../mcp/homeassistant
      dockerfile: Dockerfile
    container_name: mcp-homeassistant
    ports:
      - "3006:3000"
    environment:
      - HA_URL=${HA_URL}
      - HA_TOKEN=${HA_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # Notion MCP Server - Workspace, database, and page management
  # Custom built MCP server in /mcp/notion
  # ============================================================================
  mcp-notion:
    build:
      context: ../mcp/notion
      dockerfile: Dockerfile
    container_name: mcp-notion
    ports:
      - "3007:3000"
    environment:
      - NOTION_TOKEN=${NOTION_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # Slack MCP Server - Team communication and messaging
  # Custom built MCP server in /mcp/slack
  # ============================================================================
  mcp-slack:
    build:
      context: ../mcp/slack
      dockerfile: Dockerfile
    container_name: mcp-slack
    ports:
      - "3008:3000"
    environment:
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

networks:
  mcp_network:
    driver: bridge
    name: mcp_network
