# Minimal MCP Infrastructure - Bare Bones Setup
# Just the essentials for remote MCP access from any device

version: '3.8'

services:
  # ============================================================================
  # Cloudflare Tunnel - Secure remote access
  # ============================================================================
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    command: tunnel --no-autoupdate run
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # GitHub MCP Server - Git operations and GitHub integration
  # Uses official @modelcontextprotocol/server-github
  # ============================================================================
  mcp-github:
    image: mcp/server-github:latest
    container_name: mcp-github
    ports:
      - "3001:3000"
    environment:
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped
    # Note: If this image doesn't exist, we'll create a simple custom one

  # ============================================================================
  # Filesystem MCP Server - Access files and directories
  # Uses official @modelcontextprotocol/server-filesystem
  # ============================================================================
  mcp-filesystem:
    image: mcp/server-filesystem:latest
    container_name: mcp-filesystem
    ports:
      - "3002:3000"
    environment:
      - ALLOWED_DIRECTORIES=/data,/workspace
      - MCP_TRANSPORT=http
      - PORT=3000
    volumes:
      - ./data:/data
      - ./workspace:/workspace
    networks:
      - mcp_network
    restart: unless-stopped

  # ============================================================================
  # Google Services MCP Server - Gmail, Drive, Calendar
  # Custom built MCP server in /mcp/google
  # ============================================================================
  mcp-google:
    build:
      context: ../mcp/google
      dockerfile: Dockerfile
    container_name: mcp-google
    ports:
      - "3004:3000"
    environment:
      - GOOGLE_TOKEN_FILE=/app/credentials/token.json
      - GOOGLE_CREDENTIALS_FILE=/app/credentials/credentials.json
      - MCP_TRANSPORT=http
      - PORT=3000
    volumes:
      # Mount your Google OAuth credentials
      # After authenticating locally, copy token.json and credentials.json here
      - ./credentials/google:/app/credentials:ro
    networks:
      - mcp_network
    restart: unless-stopped
    # Note: You must authenticate locally first to generate token.json
    # See mcp/google/README.md for instructions

  # ============================================================================
  # Todoist MCP Server - Task management
  # Custom built MCP server in /mcp/todoist
  # ============================================================================
  mcp-todoist:
    build:
      context: ../mcp/todoist
      dockerfile: Dockerfile
    container_name: mcp-todoist
    ports:
      - "3005:3000"
    environment:
      - TODOIST_API_TOKEN=${TODOIST_API_TOKEN}
      - MCP_TRANSPORT=http
      - PORT=3000
    networks:
      - mcp_network
    restart: unless-stopped

networks:
  mcp_network:
    driver: bridge
    name: mcp_network
